const Discord = require('discord.js');
const client = new Discord.Client(); 
const SQLite = require("better-sqlite3");
const sql = new SQLite('./sqlTest.sqlite');

//INITIALIZATION
client.on('ready', () => {
	    //set channel connections here
	    var myChannel = client.channels.get("552307425127170058");

	    //Random wakeup text
	    let random = Math.floor(Math.random() * 3);
	    console.log("Wakeup response: " + random);
	    switch(random)
	    {
	    	case 0:
	    		myChannel.send("Good... Morning? Eh, time is relative.");
	    		break;
	    	case 1:
	    		myChannel.send("_Groan..._");
	    		myChannel.send("No, no I'm awake I swear.");
	    		break;
	    	case 2:
	    		myChannel.send("Helloyesnoididntdrinkall" +
	    			"thecoffeeimfinehowcanihelpyou?");
	    }
});

//MESSAGE RESPONSE
client.on('message', (message) => {
	//This prevents the bot from responding to its own messages
	if(message.author.bot) return;

	//Check if bot was tagged
	if(message.content.includes(client.user.toString()))
	{
		message.channel.send("I hear you loud and clear, " +
			message.author.toString() + "!");
	}

	//If message is a command, call commandHandler function
	if(message.content.startsWith("!"))
	{
		commandHandler(message);
	}
});

//PROCESS COMMANDS
function commandHandler(message)
{
	//remove exclamation point and split by spaces
	let fullCommand = message.content.substr(1).split(" ");
	//command itself is only the term immediately after the exclamation point
	let command = fullCommand[0];
	//all following terms are arguments
	let arguments = fullCommand.slice(1);

	//now, based on what the command is, call the appropriate handler

	/*TODO:
	 *Make "time" command that just reports what time it is on the bot's
	 *machine
	 *
	 *Make "remind" command that stores a reminder message 
	 *with a day and time argument to an sql database. The bot will
	 *DM the user with the reminder when the time comes. 
	*/

	if(command == "time")
	{
		//message.channel.send("What time is it? Well, I would make a " +
		//	"freckle joke here, but I don't have arms.");
		getTime(message);
	}
	else if(command == "remind")
	{
		message.channel.send("I don't know how to remind yet");
	}
}

//Get time and print out the current time in EST
function getTime(message)
{
	let date = new Date();
	let timeOutput = "It's " + date.getHours() + ":";
	let minutes = date.getMinutes();
	if(minutes < 10)
	{
		timeOutput += "0" + minutes;
	}
	else
	{
		timeOutput += minutes;
	}
	message.channel.send(timeOutput);
}

// Get your bot's secret token from:
// https://discordapp.com/developers/applications/
// Click on your application -> Bot -> Token -> "Click to Reveal Token"
bot_secret_token = "NTUyMjk1ODQ4OTUyODU2NTgy.D19d3Q.jnDcSeVUyVRHKV_2Ao6rDWIvwaY";

client.login(bot_secret_token);